<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Empire Game</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      margin: 0;
      background-color: black;
      color: white;
      font-family: Arial, sans-serif;
      text-align: center;
    }

    #loading_game {
      position: absolute;
      width: 100%;
      height: 100%;
      background-color: #000;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
    }

    #inner_progress_bar {
      width: 0%;
      height: 8px;
      background-color: #4CAF50;
      transition: width 0.5s;
    }

    #flash_enabler {
      display: none;
      color: yellow;
      margin-top: 10px;
    }

    #game-container {
      width: 100%;
      height: 100vh;
      display: none;
    }
  </style>
</head>
<body onload="initializeGame()">

  <div id="loading_game">
    <h2 id="loading_message">Cargando juego...</h2>
    <div id="progress_bar" style="width: 80%; background-color: #333;">
      <div id="inner_progress_bar"></div>
    </div>
    <div id="flash_enabler">Por favor activa Flash para continuar.</div>
  </div>

  <div id="game-container">
    <object
      type="application/x-shockwave-flash"
      data="https://168.138.165.231/files/empire-s.assets.zgncdn.com/assets/109338/ZGame.109338_tracer2.swf"
      width="100%"
      height="100%">
      <param name="allowScriptAccess" value="always">
      <param name="allowFullScreen" value="true">
      <param name="wmode" value="direct">
    </object>
  </div>

  <!-- Firebase -->
  <script type="module">
    // Importar Firebase
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
    import { getDatabase, ref, set, get, child } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-database.js";

    // Configuración de tu Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyBJZ4HvSxc3Ed_mlgNMQfGQ0QFGDMAoFkk",
      authDomain: "empire-6ea26.firebaseapp.com",
      projectId: "empire-6ea26",
      storageBucket: "empire-6ea26.firebasestorage.app",
      messagingSenderId: "617496523953",
      appId: "1:617496523953:web:4136245f1c114219f75e90"
    };

    // Inicializar Firebase
    const app = initializeApp(firebaseConfig);
    const database = getDatabase(app);

    // ---------------- FUNCIONES DEL JUEGO ----------------
    function initializeGame() {
      document.getElementById("loading_message").innerText = "Conectando a Firebase...";
      document.getElementById("inner_progress_bar").style.width = "20%";

      // Simular conexión y carga de datos del jugador
      const userId = "user123";
      saveUserData(userId, "Jugador");
      loadUserData(userId);
      saveFriend(userId, "friend1", "Amigo 1");
      loadFriends(userId);

      setTimeout(() => {
        document.getElementById("inner_progress_bar").style.width = "100%";
        document.getElementById("loading_message").innerText = "Cargando juego...";
        setTimeout(() => {
          document.getElementById("loading_game").style.display = "none";
          document.getElementById("game-container").style.display = "block";
        }, 1000);
      }, 1500);
    }

    function saveUserData(userId, name, level = 1, coins = 100) {
      set(ref(database, 'users/' + userId), {
        name,
        level,
        coins
      }).then(() => {
        console.log("Usuario guardado:", name);
      });
    }

    function loadUserData(userId) {
      const dbRef = ref(database);
      get(child(dbRef, 'users/' + userId)).then(snapshot => {
        if (snapshot.exists()) console.log("Datos usuario:", snapshot.val());
        else console.log("No hay datos del usuario");
      });
    }

    function saveFriend(userId, friendId, friendName) {
      set(ref(database, 'friends/' + userId + '/' + friendId), { name: friendName });
      console.log("Amigo guardado:", friendName);
    }

    function loadFriends(userId) {
      const dbRef = ref(database);
      get(child(dbRef, 'friends/' + userId)).then(snapshot => {
        if (snapshot.exists()) console.log("Amigos:", snapshot.val());
        else console.log("No hay amigos guardados");
      });
    }
  </script>

</body>
</html>
