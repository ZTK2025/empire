<!DOCTYPE html>
<html lang="en">
<head>
	<!-- Meta -->
	<meta charset="utf-8"/>
	<!-- Title and Icon -->
	<title id="pageTitle">Empires &amp; Allies</title>
	<link rel="shortcut icon" href="img/icon.png"/>
	<link rel="icon" type="image/png" href="img/icon.png"/>
	<!-- CSS -->
	<link rel="stylesheet" href="css/facebook.css"/>
	<link rel="stylesheet" href="css/buttons.css"/>
	<link rel="stylesheet" href="css/tooltiplink.css"/>
	<link rel="stylesheet" href="css/zbar.css"/>
	
	<!-- ✅ CDNs CORREGIDOS -->
	<script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.2.0/socket.io.js"></script>
	<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
	<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
	
	<!-- Tus scripts locales -->
	<script src="js/socketio.js"></script>
	<script src="js/flash.js"></script>
	<script src="js/session.js"></script>
	<script src="js/empires.js"></script>
	
	<script>
		// Función de carga
		function loadingScreenUpdate(progress) {
			console.log("Loading:", progress + "%");
			const innerBar = document.getElementById('inner_progress_bar');
			const message = document.getElementById('loading_message');
			if (innerBar) innerBar.style.width = progress + '%';
			if (message) {
				if (progress < 30) message.textContent = "Cargando recursos...";
				else if (progress < 70) message.textContent = "Inicializando juego...";
				else message.textContent = "¡Casi listo!";
			}
		}

		function getUserInfo() {
			console.log("getUserInfo called");
			inner_getUserInfo();
			return {
				'zid': 7555344846045843,
				'uid': 7555344846045843,
				'first_name': "Emperor",
				'name': "Emperor",
				"sex": 'F',
				'pic_square': 'img/avatars/blank.png'
			};
		}

		function getFriendData() {
			console.log("getFriendData called");
			inner_getFriendData();
			return [];
		}

		function getAppFriendIds() {
			console.log("getAppFriendIds called");
			inner_getAppFriendIds();
			return [];
		}

		function onGameLoaded(seen, popp, canvas) {
			console.log("Game is loaded " + seen + ", " + popp + ", " + canvas)
			inner_onGameLoaded();
			return;
		}

		// Firebase Integration
		function initFirebase() {
			try {
				const firebaseConfig = {
					apiKey: "AIzaSyBJZ4HvSxc3Ed_mlgNMQfGQ0QFGDMAoFkk",
					authDomain: "empire-6ea26.firebaseapp.com",
					projectId: "empire-6ea26",
					storageBucket: "empire-6ea26.firebasestorage.app",
					messagingSenderId: "617496523953",
					appId: "1:617496523953:web:4136245f1c114219f75e90",
					databaseURL: "https://empire-6ea26-default-rtdb.firebaseio.com/"
				};
				
				if (typeof firebase !== 'undefined') {
					firebase.initializeApp(firebaseConfig);
					const db = firebase.database();
					console.log("✅ Firebase inicializado correctamente");
					return { db };
				} else {
					console.log("❌ Firebase no está disponible");
					return null;
				}
			} catch (error) {
				console.log("❌ Error inicializando Firebase:", error);
				return null;
			}
		}

		// Inicializar cuando cargue la página
		document.addEventListener('DOMContentLoaded', function() {
			// Crear pantalla de carga si no existe
			if (!document.getElementById('loading_game')) {
				const loadingHTML = `
					<div id="loading_game" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; color: white; display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 9999;">
						<h2>Empires & Allies</h2>
						<div style="width: 300px; height: 20px; background: #333; border-radius: 10px; margin: 20px 0;">
							<div id="inner_progress_bar" style="width: 0%; height: 100%; background: #4CAF50; border-radius: 10px; transition: width 0.3s;"></div>
						</div>
						<p id="loading_message">Cargando recursos...</p>
					</div>
				`;
				document.body.insertAdjacentHTML('afterbegin', loadingHTML);
			}

			// Iniciar Firebase
			const firebaseApp = initFirebase();
			
			// Simular carga progresiva
			let progress = 0;
			const loadingInterval = setInterval(() => {
				progress += 5;
				loadingScreenUpdate(progress);
				
				if (progress >= 100) {
					clearInterval(loadingInterval);
					setTimeout(() => {
						const loadingElement = document.getElementById('loading_game');
						if (loadingElement) {
							loadingElement.style.display = 'none';
							console.log("✅ Pantalla de carga ocultada");
						}
					}, 500);
				}
			}, 100);
		});
	</script>
</head>
<body class="ego_wide canvas center_fixed_width_app fbx UIPage_LoggedOut liquid hideBanner Locale_en_US">
	<!-- El contenido de tu juego aquí -->
	<div id="game_container" style="padding: 20px;">
		<h1>¡Empires & Allies!</h1>
		<p>El juego está cargado y funcionando correctamente.</p>
		<div id="game_content">
			<!-- Aquí va tu juego real -->
		</div>
	</div>
</body>
</html>
